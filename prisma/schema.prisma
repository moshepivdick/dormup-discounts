generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Venue {
  id                Int           @id @default(autoincrement())
  name              String
  city              String
  category          String
  discountText      String
  details           String?
  openingHours      String?
  openingHoursShort String?
  mapUrl            String?
  phone             String?
  latitude          Float
  longitude         Float
  imageUrl          String?
  thumbnailUrl      String?
  isActive          Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  discountUses      DiscountUse[]
  partner           Partner?
  views             VenueView[]

  @@index([city])
  @@index([category])
}

model DiscountUse {
  id            Int       @id @default(autoincrement())
  venueId       Int
  generatedCode String    @unique
  status        String    @default("generated")
  qrSlug        String?   @unique
  createdAt     DateTime  @default(now())
  expiresAt     DateTime
  confirmedAt   DateTime?
  venue         Venue     @relation(fields: [venueId], references: [id])
}

model Partner {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  venueId      Int       @unique
  createdAt    DateTime  @default(now())
  lastLoginAt  DateTime?
  isActive     Boolean   @default(true)
  venue        Venue     @relation(fields: [venueId], references: [id])
}

model Admin {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  role         String    @default("admin")
  createdAt    DateTime  @default(now())
  lastLoginAt  DateTime?
}

model VenueView {
  id        Int      @id @default(autoincrement())
  venueId   Int
  city      String
  createdAt DateTime @default(now())
  userAgent String?
  venue     Venue    @relation(fields: [venueId], references: [id])
}
