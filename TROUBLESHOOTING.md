# üîß Troubleshooting Guide

## –ü—Ä–æ–±–ª–µ–º–∞: "Failed to create profile. Please try again."

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

#### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
npx prisma migrate status
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate deploy
npx prisma generate
```

#### 2. –¢–∞–±–ª–∏—Ü–∞ profiles –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Supabase:**
- –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Table Editor
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Supabase SQL Editor
# –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
npx prisma migrate deploy
```

#### 3. RLS (Row Level Security) –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Supabase Dashboard ‚Üí Authentication ‚Üí Policies
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `profiles`

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∞ `profiles_insert_self` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
```sql
CREATE POLICY "profiles_insert_self" ON profiles
  FOR INSERT
  WITH CHECK (
    auth.uid() = id
    AND email = (SELECT email FROM auth.users WHERE id = auth.uid())
  );
```

#### 4. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–Ω–æ–ø–∫–∞ "Create account" –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
- –°–æ–æ–±—â–µ–Ω–∏–µ "Please select your university"

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –≤—ã–±—Ä–∞–ª–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
- –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `npm run prisma:seed:universities`

#### 5. Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ "This email is already registered"

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π email
- –ò–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ `/auth/login`

#### 6. –ù–µ–≤–µ—Ä–Ω—ã–π –¥–æ–º–µ–Ω email

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ "Email domain must match..."

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email —Å –¥–æ–º–µ–Ω–æ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
- –ò–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

**–í –±—Ä–∞—É–∑–µ—Ä–µ (Console):**
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É Console –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`
- –ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å "Profile creation error"

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
npx prisma db pull

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
npx prisma studio
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É universities

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ .env –µ—Å—Ç—å:
# - NEXT_PUBLIC_SUPABASE_URL
# - NEXT_PUBLIC_SUPABASE_ANON_KEY
# - SUPABASE_SERVICE_ROLE_KEY
```

### –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Dashboard:**
   - Authentication ‚Üí Users - –µ—Å—Ç—å –ª–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?
   - Table Editor ‚Üí profiles - –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å?

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Supabase SQL Editor:**
   ```sql
   INSERT INTO profiles (id, email, university_id, verified_student, role)
   VALUES ('test-user-id', 'test@university.it', 'university-uuid', false, 'user');
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase:**
   - Dashboard ‚Üí Logs ‚Üí Postgres Logs
   - –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞, —Å–æ–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
- –í–µ—Ä—Å–∏—è Node.js: `node --version`
- –í–µ—Ä—Å–∏—è npm: `npm --version`
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç)
- –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –õ–æ–≥–∏ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

